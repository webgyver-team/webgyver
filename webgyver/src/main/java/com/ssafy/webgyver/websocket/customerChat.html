<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>실시간 매칭 테스트 페이지</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script type="text/javascript">
        var g_webSocket = null;
        var websocket_address = "ws://localhost:9000/realtime/customer/1";
        var categoryIdx = 1;
        var price = 99999;
        window.onload = async function () {
            g_webSocket = new WebSocket(websocket_address);
            g_webSocket.onopen = function (message) {
                // 처음 접속할때 정보 설정.
                const data = JSON.stringify(
                    {
                        'method': 'INIT',
                        'categoryIdx': categoryIdx,
                        'lng': Math.random(),
                        'lat': Math.random(),
                        'address': '대전 서구 청사로 253',
                        'detailAddress': '111-2222',
                        'title': '물이 안나와요',
                        'content': '아니 물이 나오다가 안나와요\n왜안나오는지는모르겠지만유\n손이 너무 더러운디 씻을수가 없어유\n',
                        'images': [{
                            "saveName": "test123",
                            "originName": "test123"
                        },
                            {
                                "saveName": "asdf123",
                                "originName": "asdf123"
                            }],
                        'price': price,
                        'viewDistance': -1
                    }
                );
                console.log(data)
                g_webSocket.send(data);
            }

            /**
             * 웹소켓 메시지(From Server) 수신하는 경우 호출
             */
            g_webSocket.onmessage = function (message) {
                const data = JSON.parse(message.data)
                console.log(data);
                addLineToChatBox(JSON.stringify(data))
                addLineToChatBox('-----------------------------');
            };

            /**
             * 웹소켓 사용자 연결 해제하는 경우 호출
             */
            g_webSocket.onclose = function (message) {
                addLineToChatBox("Server is disconnected.");
            };

            /**
             * 웹소켓 에러 발생하는 경우 호출
             */
            g_webSocket.onerror = function (message) {
                addLineToChatBox("Error!");
            };
        }

        /**
         * 채팅 박스영역에 내용 한 줄 추가
         */
        function addLineToChatBox(_line) {
            if (_line == null) {
                _line = "";
            }

            var chatBoxArea = document.getElementById("chatBoxArea");
            chatBoxArea.value += _line + "\n";
            chatBoxArea.scrollTop = chatBoxArea.scrollHeight;
        }

        function change_distance() {
            const data = JSON.stringify(
                {
                    'method': 'CHANGE_DISTANCE',
                    'viewDistance': document.getElementById("viewDistance").value
                })
            g_webSocket.send(data);
        }


    </script>
</head>
<body>
<h1>실시간 매칭 테스트 페이지 CUSTOMER</h1>
<br/>

<input id="disconnectButton" value="Disconnect" type="button" onclick="disconnectButton_onclick()">
<br/>
<textarea id="chatBoxArea" style="width: 100%;" rows="10" cols="50" readonly="readonly"></textarea>
<br/>
판매자와의 거리가 <input id="viewDistance">
<button onclick="change_distance()">km 이내만 보기</button>

</body>
</html>