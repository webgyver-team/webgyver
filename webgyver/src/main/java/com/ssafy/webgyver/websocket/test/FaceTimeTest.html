<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>소비자 화상통화 페이지</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script type="text/javascript">
        var g_webSocket = null;
        var mode = null;
        set_customer = function () {
            mode = "customer";
            document.getElementById("mode").value = mode;
        }
        set_seller = function () {
            mode = "seller";
            document.getElementById("mode").value = mode;
        }

        enter = async function () {
            // var websocket_address = "ws://i8b101.p.ssafy.io:9000/facetime/";
            var websocket_address = `ws://localhost:9000/facetime/${mode}/${document.getElementById("idx").value}/${document.getElementById("reservationIdx").value}`;
            console.log(websocket_address);
            g_webSocket = new WebSocket(websocket_address);
            g_webSocket.onopen = function (message) {
                console.log("연결 성공");
            }

            g_webSocket.onmessage = function (message) {
                const data = JSON.parse(message.data)
                const method = data.method;
                console.log("데이터 수신");
                console.log(data);
                console.log(data.method);

                if (method == 'ALONE') {
                    console.log("상대방 기다리는중")
                }
                if (method == 'TOGETHER') {
                    console.log("둘다 왔다 드가자!!!!")
                }
                if (method == 'ACCEPT_MEET') {
                    console.log("출장요청 수락함..")
                    alert("상대방이 출장요청을 수락했어요~")
                }
            };

            g_webSocket.onclose = function (message) {
                console.log("연결 끊어짐!!")
            };

            g_webSocket.onerror = function (message) {
                console.log("오류 발생!!")
            };

        }
    </script>
</head>
<body>
<h1>소비자 화상통화 페이지</h1>
<br/>
<button onclick="set_customer()">소비자모드</button>
<br/>
<button onclick="set_seller()">판매자모드</button>
<br/>
모드 : <input id="mode" readonly="readonly"><br/>
예약번호 : <input id="reservationIdx"><br/>
idx : <input id="idx"><br/>
<button onclick="enter()">입장</button>

</body>
</html>